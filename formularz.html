<?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32)); // Tworzenie tokena CSRF
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formularz zgłoszeniowy</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function sprawdzKodSilnika() {
            let marka = document.getElementById("marka").value.trim();
            let model = document.getElementById("model").value.trim();
            let moc = document.getElementById("moc").value.trim();
            let pojemnosc = document.getElementById("pojemnosc").value.trim();
            let rok = document.getElementById("rok").value.trim();
            let kodSilnika = document.getElementById("kod_silnika").value.trim();
            let sekcjaKlienta = document.getElementById("client-section");

            // Aktualizacja sekcji wybranych wartości
            document.getElementById("selected-marka").textContent = marka || "-";
            document.getElementById("selected-model").textContent = model || "-";
            document.getElementById("selected-moc").textContent = moc || "-";
            document.getElementById("selected-pojemnosc").textContent = pojemnosc || "-";
            document.getElementById("selected-rok").textContent = rok || "-";
            document.getElementById("selected-kod").textContent = kodSilnika || "-";

            // Sprawdzamy, czy wszystkie pola samochodu są wypełnione
            if (marka && model && moc && pojemnosc && rok) {
                if (kodSilnika === "") {
                    sekcjaKlienta.style.display = "block"; // Pokazuje dane klienta
                } else {
                    sekcjaKlienta.style.display = "none"; // Ukrywa dane klienta
                }
            }
        }

        window.onload = function () {
            document.getElementById("client-section").style.display = "none"; // Ukrywa dane klienta na start
        };
    </script>
</head>
<body>
    <div class="form-container">
        <form action="przetworz.php" method="post">
            <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">

            <h2>Dane samochodu</h2>

            <label for="marka">Marka:</label>
            <input type="text" id="marka" name="marka" required maxlength="50" oninput="sprawdzKodSilnika()">

            <label for="model">Model:</label>
            <input type="text" id="model" name="model" required maxlength="50" oninput="sprawdzKodSilnika()">

            <label for="moc">Moc (KM):</label>
            <input type="number" id="moc" name="moc" required min="10" max="2000" oninput="sprawdzKodSilnika()">

            <label for="pojemnosc">Pojemność (cm³):</label>
            <input type="number" id="pojemnosc" name="pojemnosc" required min="500" max="10000" oninput="sprawdzKodSilnika()">

            <label for="rok">Rok produkcji:</label>
            <input type="number" id="rok" name="rok" required min="1900" max="2025" oninput="sprawdzKodSilnika()">

            <label for="kod_silnika">Kod silnika:</label>
            <input type="text" id="kod_silnika" name="kod_silnika" required pattern="[A-Za-z0-9]+" maxlength="10" oninput="sprawdzKodSilnika()">

            <!-- Sekcja danych klienta (ukryta na start) -->
            <div id="client-section" style="display: none;">
                <h2>Dane klienta</h2>

                <label for="imie">Imię:</label>
                <input type="text" id="imie" name="imie">

                <label for="nazwisko">Nazwisko:</label>
                <input type="text" id="nazwisko" name="nazwisko">

                <label for="email">Email:</label>
                <input type="email" id="email" name="email">

                <label for="telefon">Telefon:</label>
                <input type="text" id="telefon" name="telefon">
            </div>

            <input type="submit" value="Wyślij">
        </form>

        <!-- Sekcja wybranych wartości -->
        <div class="selected-values">
            <h2>Wybrane wartości</h2>
            <p><strong>Marka:</strong> <span id="selected-marka">-</span></p>
            <p><strong>Model:</strong> <span id="selected-model">-</span></p>
            <p><strong>Moc:</strong> <span id="selected-moc">-</span></p>
            <p><strong>Pojemność:</strong> <span id="selected-pojemnosc">-</span></p>
            <p><strong>Rok produkcji:</strong> <span id="selected-rok">-</span></p>
            <p><strong>Kod silnika:</strong> <span id="selected-kod">-</span></p>
        </div>
    </div>
</body>
</html>
