<?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32)); // Tworzenie tokena CSRF
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formularz zgłoszeniowy</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function updateSelectedValues() {
            document.getElementById("selected-marka").textContent = document.getElementById("marka").value || "-";
            document.getElementById("selected-model").textContent = document.getElementById("model").value || "-";
            document.getElementById("selected-kod_silnika").textContent = document.getElementById("kod_silnika").value || "-";
            document.getElementById("selected-moc").textContent = document.getElementById("moc").value || "-";
            document.getElementById("selected-pojemnosc").textContent = document.getElementById("pojemnosc").value || "-";
            document.getElementById("selected-rok_produkcji").textContent = document.getElementById("rok_produkcji").value || "-";
        }

        function sprawdzKodSilnika() {
            let kodSilnika = document.getElementById("kod_silnika").value.trim().toUpperCase();
            let daneKlienta = document.getElementById("dane-klienta");
            let submitButton = document.getElementById("submit-button");

            if (kodSilnika === "" || kodSilnika !== "DDAA") {
                daneKlienta.style.display = "block"; // Pokaż dane klienta
                submitButton.disabled = false; // Aktywuj przycisk "Wyślij"
            } else {
                daneKlienta.style.display = "none"; // Ukryj dane klienta
                submitButton.disabled = false; // Aktywuj przycisk "Wyślij"
            }

            updateSelectedValues();
        }

        // Nasłuchuj zmian w polach wejściowych i aktualizuj podsumowanie
        document.addEventListener("DOMContentLoaded", function() {
            let inputs = document.querySelectorAll("input");
            inputs.forEach(input => {
                input.addEventListener("input", updateSelectedValues);
            });
        });
    </script>
</head>
<body>
    <div class="form-container">
        <h1>Formularz zgłoszeniowy</h1>
        <form action="przetworz.php" method="post">
            <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">

            <!-- Dane samochodu -->
            <label for="marka">Marka pojazdu:</label>
            <input type="text" name="marka" id="marka" required>

            <label for="model">Model pojazdu:</label>
            <input type="text" name="model" id="model" required>

            <label for="kod_silnika">Kod silnika:</label>
            <input type="text" name="kod_silnika" id="kod_silnika" required>

            <label for="moc">Moc (KM):</label>
            <input type="number" name="moc" id="moc" required>

            <label for="pojemnosc">Pojemność (cm³):</label>
            <input type="number" name="pojemnosc" id="pojemnosc" required>

            <label for="rok_produkcji">Rok produkcji:</label>
            <input type="number" name="rok_produkcji" id="rok_produkcji" required>

            <!-- Przycisk Sprawdź -->
            <button type="button" onclick="sprawdzKodSilnika()">Sprawdź</button>

            <!-- Dane klienta (ukryte na start) -->
            <div id="dane-klienta" style="display: none;">
                <h2>Dane klienta:</h2>

                <label for="imie_nick">Imię lub nick:</label>
                <input type="text" name="imie_nick" id="imie_nick">

                <label for="adres">Adres:</label>
                <input type="text" name="adres" id="adres">

                <label for="kod">Kod pocztowy:</label>
                <input type="text" name="kod" id="kod">

                <label for="miasto">Miasto:</label>
                <input type="text" name="miasto" id="miasto">

                <label for="wojewodztwo">Województwo:</label>
                <input type="text" name="wojewodztwo" id="wojewodztwo">

                <label for="telefon">Telefon:</label>
                <input type="text" name="telefon" id="telefon">

                <label for="email">E-mail:</label>
                <input type="email" name="email" id="email">
            </div>

            <!-- Przycisk Wyślij (aktywny po sprawdzeniu) -->
            <input type="submit" value="Wyślij" id="submit-button" disabled>
        </form>

        <!-- Sekcja wybranych wartości -->
        <div class="selected-values">
            <h2>Wybrane wartości:</h2>
            <p><strong>Marka:</strong> <span id="selected-marka" class="highlight-red">-</span></p>
            <p><strong>Model:</strong> <span id="selected-model" class="highlight-red">-</span></p>
            <p><strong>Kod silnika:</strong> <span id="selected-kod_silnika" class="highlight-red">-</span></p>
            <p><strong>Moc (KM):</strong> <span id="selected-moc" class="highlight-red">-</span></p>
            <p><strong>Pojemność (cm³):</strong> <span id="selected-pojemnosc" class="highlight-red">-</span></p>
            <p><strong>Rok produkcji:</strong> <span id="selected-rok_produkcji" class="highlight-red">-</span></p>
        </div>
    </div>
</body>
</html>
