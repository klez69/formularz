<?php
session_start();
if (empty($_SESSION['csrf_token'])) {
    $_SESSION['csrf_token'] = bin2hex(random_bytes(32)); // Tworzenie tokena CSRF
}
?>

<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formularz zgłoszeniowy</title>
    <link rel="stylesheet" href="style.css">
    <script>
        function toggleClientSection() {
            let kodSilnika = document.getElementById("kod_silnika").value.trim();
            let clientSection = document.getElementById("client-section");

            if (kodSilnika === "") {
                clientSection.style.display = "block"; // Pokaż sekcję danych klienta
                setClientFieldsRequired(true);
            } else {
                clientSection.style.display = "none"; // Ukryj sekcję danych klienta
                setClientFieldsRequired(false);
            }
        }

        function setClientFieldsRequired(required) {
            document.getElementById("imie").required = required;
            document.getElementById("nazwisko").required = required;
            document.getElementById("email").required = required;
            document.getElementById("telefon").required = required;
        }

        window.onload = function () {
            toggleClientSection();
        };
    </script>
</head>
<body>
    <div class="form-container">
        <form action="przetworz.php" method="post">
            <input type="hidden" name="csrf_token" value="<?php echo $_SESSION['csrf_token']; ?>">

            <h2>Dane samochodu</h2>

            <label for="marka">Marka:</label>
            <input type="text" id="marka" name="marka" required maxlength="50">

            <label for="model">Model:</label>
            <input type="text" id="model" name="model" required maxlength="50">

            <label for="moc">Moc (KM):</label>
            <input type="number" id="moc" name="moc" required min="10" max="2000">

            <label for="pojemnosc">Pojemność (cm³):</label>
            <input type="number" id="pojemnosc" name="pojemnosc" required min="500" max="10000">

            <label for="rok">Rok produkcji:</label>
            <input type="number" id="rok" name="rok" required min="1900" max="2025">

            <label for="kod_silnika">Kod silnika:</label>
            <input type="text" id="kod_silnika" name="kod_silnika" required pattern="[A-Za-z0-9]+" maxlength="10" oninput="toggleClientSection()">

            <!-- Sekcja danych klienta (ukryta na start) -->
            <div id="client-section" style="display: none;">
                <h2>Dane klienta</h2>

                <label for="imie">Imię:</label>
                <input type="text" id="imie" name="imie">

                <label for="nazwisko">Nazwisko:</label>
                <input type="text" id="nazwisko" name="nazwisko">

                <label for="email">Email:</label>
                <input type="email" id="email" name="email">

                <label for="telefon">Telefon:</label>
                <input type="text" id="telefon" name="telefon">
            </div>

            <input type="submit" value="Wyślij">
        </form>
    </div>
</body>
</html>
